<form class="filter-container" [formGroup]="filterForm" (ngSubmit)="triggerSearch($event)">
  <div class="search-filter">
    @for (criteria of criteria; track criteria) {
      <div>
        @if (criteria.filterDataType === 'string') {
          <div class="search-filter-input">
            @if (criteria.referenceId !== 'vn') {
              <bc-filter-text
                [formControlName]="criteria.referenceId"
                [label]="'shared.filter-labels.' + criteria.referenceId | translate"
                [clearable]="false"
                [optionalText]="''"
                [width]="'200px'"
                [error]="
                  !(
                    filterForm.controls[criteria.referenceId].valid ||
                    filterForm.controls[criteria.referenceId].pristine
                  )
                "
                [(ngModel)]="criteria.filterValue"
                [icon]="criteria.filterOperator"
                (filterChange)="filterChange($event, criteria)"
                [operation]="criteria.filterOperator"
                subscriptSizing="dynamic"
              >
              </bc-filter-text>
            } @else {
              <bc-text
                [formControlName]="criteria.referenceId"
                [label]="'shared.filter-labels.' + criteria.referenceId | translate"
                [clearable]="false"
                [optionalText]="''"
                [width]="'200px'"
                [placeholder]="'756.xxxx.xxxx.xx'"
                [error]="
                  !(
                    filterForm.controls[criteria.referenceId].valid ||
                    filterForm.controls[criteria.referenceId].pristine
                  )
                "
                [(ngModel)]="criteria.filterValue"
                subscriptSizing="dynamic"
              >
              </bc-text>
            }
            <mat-icon
              fontSet="abraxas-icons"
              fontIcon="icon-cancel"
              class="search-filter-input__cancel"
              (click)="deleteCriteria(criteria.referenceId)"
            ></mat-icon>
          </div>
        }
        @if (criteria.filterDataType === 'date') {
          <div class="search-filter-input">
            <bc-filter-date
              [formControlName]="criteria.referenceId"
              [label]="'shared.filter-labels.' + criteria.referenceId | translate"
              [optionalText]="''"
              [error]="
                !(
                  filterForm.controls[criteria.referenceId].valid ||
                  filterForm.controls[criteria.referenceId].pristine
                )
              "
              [(ngModel)]="criteria.filterValue"
              [clearable]="false"
              (filterChange)="filterChange($event, criteria)"
              [operation]="criteria.filterOperator"
            ></bc-filter-date>
            <mat-icon
              fontSet="abraxas-icons"
              fontIcon="icon-cancel"
              class="search-filter-input__cancel"
              (click)="deleteCriteria(criteria.referenceId)"
            ></mat-icon>
          </div>
        }
        @if (criteria.filterDataType === 'boolean') {
          <div class="search-filter-input__boolField">
            <bc-checkbox
              [formControlName]="criteria.referenceId"
              [label]="'shared.filter-labels.' + criteria.referenceId | translate"
              [(ngModel)]="criteria.filterValue"
              subscriptSizing="dynamic"
            ></bc-checkbox>
            <mat-icon
              fontSet="abraxas-icons"
              fontIcon="icon-cancel"
              class="search-filter-input__boolCancel"
              (click)="deleteCriteria(criteria.referenceId)"
            ></mat-icon>
          </div>
        }
        @if (criteria.filterDataType === 'numeric' && !isFilterControl(criteria.referenceId)) {
          <div class="search-filter-input">
            <bc-filter-number
              [formControlName]="criteria.referenceId"
              [label]="'shared.filter-labels.' + criteria.referenceId | translate"
              [optionalText]="''"
              [required]="true"
              [clearable]="false"
              [(ngModel)]="criteria.filterValue"
              (filterChange)="filterChange($event, criteria)"
              [operations]="numberFilterOperations"
              subscriptSizing="dynamic"
            ></bc-filter-number>
            <mat-icon
              fontSet="abraxas-icons"
              fontIcon="icon-cancel"
              class="search-filter-input__cancel"
              (click)="deleteCriteria(criteria.referenceId)"
            ></mat-icon>
          </div>
        }
        @if (criteria.filterDataType === 'numeric' && isFilterControl(criteria.referenceId)) {
          <div class="search-filter-input">
            <bc-filter-number
              [formControlName]="criteria.referenceId"
              [label]="'shared.filter-labels.' + criteria.referenceId | translate"
              [optionalText]="''"
              [required]="true"
              [clearable]="false"
              [(ngModel)]="criteria.filterValue"
              (filterChange)="filterChange($event, criteria)"
              [operation]="criteria.filterOperator"
              subscriptSizing="dynamic"
            ></bc-filter-number>
            <mat-icon
              fontSet="abraxas-icons"
              fontIcon="icon-cancel"
              class="search-filter-input__cancel"
              (click)="deleteCriteria(criteria.referenceId)"
            ></mat-icon>
          </div>
        }
        @if (criteria.filterDataType === 'multiselect') {
          <div class="search-filter-input">
            <bc-dropdown
              [formControlName]="criteria.referenceId"
              [label]="'shared.filter-labels.' + criteria.referenceId | translate"
              [width]="'200px'"
              [items]="'select-items.' + criteria.referenceId | translationsDropdownItems"
              [displayExpr]="'displayValue'"
              [valueExpr]="'id'"
              [multiple]="true"
              [optionalText]="''"
              [(ngModel)]="criteria.filterValue"
              subscriptSizing="dynamic"
            >
            </bc-dropdown>
            <mat-icon
              fontSet="abraxas-icons"
              fontIcon="icon-cancel"
              class="search-filter-input__cancel"
              (click)="deleteCriteria(criteria.referenceId)"
            ></mat-icon>
          </div>
        }
        @if (criteria.filterDataType === 'select') {
          <div class="search-filter-input">
            <bc-dropdown
              [formControlName]="criteria.referenceId"
              [label]="'shared.filter-labels.' + criteria.referenceId | translate"
              [width]="'200px'"
              [items]="'select-items.' + criteria.referenceId | translationsDropdownItems"
              [displayExpr]="'displayValue'"
              [valueExpr]="'id'"
              [multiple]="false"
              [optionalText]="''"
              [(ngModel)]="criteria.filterValue"
              subscriptSizing="dynamic"
            ></bc-dropdown>
            <mat-icon
              fontSet="abraxas-icons"
              fontIcon="icon-cancel"
              class="search-filter-input__cancel"
              (click)="deleteCriteria(criteria.referenceId)"
            ></mat-icon>
          </div>
        }
      </div>
    }
    <bc-button
      type="button"
      [variant]="'tertiary'"
      [label]="'handle-filter.addFilter' | translate"
      [matMenuTriggerFor]="menu"
    ></bc-button>
    <mat-menu #menu>
      @for (item of selectableAttributes; track item) {
        <div>
          <div mat-menu-item (click)="addFilter(item.value)">
            {{ 'shared.filter-labels.' + item.value | translate }}
          </div>
        </div>
      }
    </mat-menu>
  </div>
  <div class="filter-container__actions">
    <bc-button [variant]="'tertiary'" [label]="'shared.action.search' | translate" type="submit"></bc-button>
    <bc-button
      [variant]="'tertiary'"
      [label]="'shared.action.reset' | translate"
      (click)="clearSearch()"
      type="button"
    ></bc-button>
    @if (canSaveFilter && isManager) {
      <bc-button
        [variant]="'tertiary'"
        [label]="'handle-filter.new-title' | translate"
        (click)="newFilter()"
        type="button"
      ></bc-button>
    }
  </div>
</form>
